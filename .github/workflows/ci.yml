name: Build legate.core
on: [push, pull_request]
env:
  DOCKER_AUTH_TOKEN: ${{ secrets.DOCKER_AUTH_TOKEN }}
  COMMIT: ${{ github.event.pull_request.head.sha }}
  PROJECT: github-core-ci
jobs:
  build:
    runs-on: self-hosted
    steps:
      - uses: actions/checkout@v2
        with:
          ref: ${{ github.event.pull_request.head.sha }}
      - name: Run CI
        run: |
          set -x
          ls
          cd ..
          ls
          if [[ ! -d legate-ci ]]
          then
            git clone ssh://git@gitlab-master.nvidia.com:12051/legate/legate-ci.git
          else
            cd legate-ci
            git pull
            cd ..
          fi
          mv -f legate.core legate-ci
          cd legate-ci
          ls
          ./github-ci/legate.core/build.sh
          
